#include "stdio.h"
#include "string.h"
#include "ctype.h"
#include "stdlib.h"

#include "math.h"
#include "time.h"

#define OK 1
#define ERROR 0
#define TRUE 1
#define FALSE 0

#define MAXSIZE 20 /* ????????????��????? */

typedef int Status;   /* Status?????????��??,???????????��??��????��??????OK?? */
typedef int ElemType; /* ElemType?��???��???????��?????��?????????��??int */

Status visit(ElemType c)
{
    printf("%d ", c);
    return OK;
}

// 线性表的单链表存储结构
typedef struct Node
{
    ElemType data;     // 数据字段，存储数据元素。ElemType 需要事先定义或替换为实际的数据类型，比如 int、char 等。
    struct Node *next; // 指针字段，指向下一个链表节点
} Node;
typedef struct Node *LinkList; /* 定义LinkList */

/* ??????????????���� */
Status InitList(LinkList *L)
{
    *L = (LinkList)malloc(sizeof(Node)); /* ?��?��?��?��??,????L???��???��?��?? */
    if (!(*L))                           /* ????��????���? */
        return ERROR;
    (*L)->next = NULL; /* ?????��???? */

    return OK;
}

/* ??????????????????����L??????????����?��??????L????����???����???TRUE??��??����???FALSE */
Status ListEmpty(LinkList L)
{
    if (L->next)
        return FALSE;
    else
        return TRUE;
}

/* ??????????????????����L??????????����?��??????L????????���� */
Status ClearList(LinkList *L) // �ⲻ�����⡣
{
    LinkList p, q;
    p = (*L)->next; /*  p???��???????��?? */
    while (p)       /*  ????����?? */
    {
        q = p->next;
        free(p);
        p = q;
    }
    (*L)->next = NULL; /* ?��?��???????��???? */
    return OK;
}

/* ??????????????????����L??????????����?��????��???L?????????????? */
int ListLength(LinkList L)
{
    int i = 0;
    LinkList p = L->next; /* p???��???????��?? */
    while (p)
    {
        i++;
        p = p->next;
    }
    return i;
}

/* 初始条件：链式线性表L已存在，1<=i<=ListLength(L) */
/* 操作结果：用e返回L中第i个数据元素的值 */
Status GetElem(LinkList L, int i, ElemType *e)
{
    int j;
    LinkList p;        /* 声明一结点p */
    p = L->next;       /* 让p指向链表L的第一个结点 */
    j = 1;             /*  j为计数器 */
    while (p && j < i) /* p不为空或者计数器j还没有等于i时，循环继续 */
    {
        p = p->next; /* 让p指向下一个结点 */
        ++j;
    }
    if (!p || j > i)
        return ERROR; /*  第i个元素不存在 */
    *e = p->data;     /*  取第i个元素的数据 */
    return OK;
}

/* ??????????????????����L?????? */
/* ??����?��????��???L????1????e?����????????????????????��?? */
/* ?????��???????????????????����???????0 */
int LocateElem(LinkList L, ElemType e)
{
    int i = 0;
    LinkList p = L->next;
    while (p)
    {
        i++;
        if (p->data == e) /* ???????��?????????? */
            return i;
        p = p->next;
    }

    return 0;
}

/* ??????????????????����L??????,1??i??ListLength(L)?? */
/* ??����?��??????L????i?????????��????????????????e??L???��????1 */
Status ListInsert(LinkList *L, int i, ElemType e)
{
    int j;
    LinkList p, s;
    p = *L;
    j = 1;
    while (p && j < i) /* ?��????i???��?? */
    {
        p = p->next;
        ++j;
    }
    if (!p || j > i)
        return ERROR;                   /* ??i???????????? */
    s = (LinkList)malloc(sizeof(Node)); /*  ?��?????��??(C????������?????) */
    s->data = e;
    s->next = p->next; /* ??p???��???��????????s???��??  */
    p->next = s;       /* ??s??????p???��?? */
    return OK;
}

/* ??????????????????����L????????1??i??ListLength(L) */
/* ??����?��????????L????i????????????????e��?????????L???��????1 */
Status ListDelete(LinkList *L, int i, ElemType *e)
{
    int j;
    LinkList p, q;
    p = *L;
    j = 1;
    while (p->next && j < i) /* ����?��?��????i?????? */
    {
        p = p->next;
        ++j;
    }
    if (!(p->next) || j > i)
        return ERROR; /* ??i???????????? */
    q = p->next;
    p->next = q->next; /* ??q???��????????p???��?? */
    *e = q->data;      /* ??q?��????????????e */
    free(q);           /* ?????????????��??????��????? */
    return OK;
}

/* ??????????????????����L?????? */
/* ??����?��??????????L?????????????????? */
Status ListTraverse(LinkList L)
{
    LinkList p = L->next;
    while (p)
    {
        visit(p->data);
        p = p->next;
    }
    printf("\n");
    return OK;
}

/*  ???��?��?��n?????????????��????����?��?��????????????����L?��?��??����?? */
void CreateListHead(LinkList *L, int n)
{
    LinkList p;
    int i;
    srand(time(0));                                           /* ?????????��????��? */
    *L = (LinkList)malloc(sizeof(Node));                      // ��L��һ��ָ�룬���ڱ��������ڴ�ĵ�ַ��������ָ�������������㡣����������˼�ǣ���̬����һ����СΪNode�ṹ����ڴ�飬��������ڴ�ĵ�ַת��ΪLinkList���͵�ָ�룬Ȼ��ֵ��L��
    (*L)->next = NULL; /*  ???��?????????��?��????????���� */ // ���������ﾳ�У���nextָ������ΪNULL��ζ�ŵ�ǰ��㣨��Lָ��ָ��û��ָ���κκ�����㣬���������������һ����㡣��ͨ���ڴ����½����ʼ��������β�����ʱʹ�ã���ȷ��������ĩβ��һ����ȷ�Ľ�����־����C�����У�NULLָ�볣�������������������ݽṹ��ĩβ�������־��
    for (i = 0; i < n; i++)
    {
        p = (LinkList)malloc(sizeof(Node));  /*  ?��?????��?? */
        p->data = rand() % 100 + 1;          /*  ???��?��??100????????��? */
        p->next = (*L)->next;                //(*L)->next �ǵ�ǰ����ͷ������ĵ�һ����㡣Ҳ����˵�����������ĵڶ�����㣨������ڵĻ����������뽫�´����Ľ�� p �� next ָ��ǰ�����ĵڶ�����㡣
        (*L)->next = p; /*  ??????����?�� */ // ������ʵ���ϸı�������ͷ������Ľ�㡣֮ǰ������ͷ�����������һ���ɵĽ��� NULL����������ǿյģ����������뽫���Ϊ�½�� p������ǣ��½�� p ��Ϊ�������ĵڶ�����㣬��ԭ���ĵڶ���������ڳ�Ϊ�˵�������㡣
    }                                        // ����δ����ѭ���У��½�����Ǳ����뵽������ͷ������ˣ����Ȳ���Ľ��������������β������������Ľ�����������ͷ���������ͷ�巨���ص㡣����˵�������д��빲ͬ�����ǽ��½����뵽������ͷ������ȷ����������ͷ֮��ĵ�һ����㡣
}

/*  ???��?��?��n?????????????��????����?��?��????????????����L?��????����?? */
void CreateListTail(LinkList *L, int n)
{
    LinkList p, r;
    int i;
    srand(time(0));                      /* ?????????��????��? */
    *L = (LinkList)malloc(sizeof(Node)); /* L??????????���� */
    r = *L;                              /* r?????��???????��?? */
    for (i = 0; i < n; i++)
    {
        p = (Node *)malloc(sizeof(Node));                      /*  ?��?????��?? */
        p->data = rand() % 100 + 1;                            /*  ???��?��??100????????��? */
        r->next = p; /* ??����???????��???????????��???��?? */ // ����ʱ��r ��ָ��������ǰ��β������ָ�롣�����뽫�´����Ľ�� p ���ӵ�������β����Ҳ����˵��ԭ������β���� next ָ�루��֮ǰ������ NULL������ָ�����½�� p���������½�� p ��Ϊ����������β����㡣
        r = p; /* ???��?��?????��???��????����???????��?? */   // ����������� r ��ֵ��ʹ��ָ���µ�β����� p������Ϊ����һ��ѭ��ʱ��r ��Ȼָ��������β������˿��Խ���һ���½�����ӵ�������β����
    }                                                          // ���ѭ����Ч���ǣ�����ÿ�ε����������ᴴ��һ���µĽ�� p��Ȼ�������ӵ�������β���������� r ��ȷ����ʼ��ָ��������β������������ÿ��ѭ���������½�㶼�ᱻ���ӵ�������β���������֮�������д���ȷ���½�����Ǳ����ӵ�������β���������� r ��ֵ��ʹ��ʼ��ָ�����������µ�β����㡣
    r->next = NULL;                                            /* ����???��?��??����?��?? */
}

int main()
{
    LinkList L;
    ElemType e;
    Status i;
    int j, k;
    i = InitList(&L);
    printf("??????L?��??ListLength(L)=%d\n", ListLength(L));
    for (j = 1; j <= 5; j++)
        i = ListInsert(&L, 1, j);
    printf("??L??����?��????????1??5?��??L.data=");
    ListTraverse(L);

    printf("ListLength(L)=%d \n", ListLength(L));
    i = ListEmpty(L);
    printf("L??��?????i=%d(1:?? 0:��?)\n", i);

    i = ClearList(&L);
    printf("????L?��??ListLength(L)=%d\n", ListLength(L));
    i = ListEmpty(L);
    printf("L??��?????i=%d(1:?? 0:��?)\n", i);

    for (j = 1; j <= 10; j++)
        ListInsert(&L, j, j);
    printf("??L??����??????????1??10?��??L.data=");
    ListTraverse(L);

    printf("ListLength(L)=%d \n", ListLength(L));

    ListInsert(&L, 1, 0);
    printf("??L??����?��????0?��??L.data=");
    ListTraverse(L);
    printf("ListLength(L)=%d \n", ListLength(L));

    GetElem(L, 5, &e);
    printf("??5??????????????%d\n", e);
    for (j = 3; j <= 4; j++)
    {
        k = LocateElem(L, j);
        if (k)
            printf("??%d????????????%d\n", k, j);
        else
            printf("????????%d??????\n", j);
    }

    k = ListLength(L); /* k??����?�� */
    for (j = k + 1; j >= k; j--)
    {
        i = ListDelete(&L, j, &e); /* ??????j?????? */
        if (i == ERROR)
            printf("??????%d???????���?\n", j);
        else
            printf("??????%d??????????????%d\n", j, e);
    }
    printf("????????L????????");
    ListTraverse(L);

    j = 5;
    ListDelete(&L, j, &e); /* ??????5?????? */
    printf("??????%d??????????????%d\n", j, e);

    printf("????????L????????");
    ListTraverse(L);

    i = ClearList(&L);
    printf("\n????L?��??ListLength(L)=%d\n", ListLength(L));
    CreateListHead(&L, 20);
    printf("???????��L??????(?��??����)??");
    ListTraverse(L);

    i = ClearList(&L);
    printf("\n????L?��??ListLength(L)=%d\n", ListLength(L));
    CreateListTail(&L, 20);
    printf("???????��L??????(????����)??");
    ListTraverse(L);

    return 0;
}
